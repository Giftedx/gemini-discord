{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/firebase.ts"],"sourcesContent":["/**\n * @fileOverview Initializes and exports the Firebase Admin SDK for server-side use.\n * This ensures a single instance of the SDK is used throughout the application.\n */\n\nimport admin from 'firebase-admin';\nimport { applicationDefault } from 'firebase-admin/app';\n\n// Check if the app is already initialized to prevent re-initialization\nif (!admin.apps.length) {\n  admin.initializeApp({\n    // Explicitly use Application Default Credentials for authentication.\n    // This can help resolve issues in environments where automatic\n    // credential discovery fails.\n    credential: applicationDefault(),\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  });\n}\n\nconst firestore = admin.firestore();\n\nexport { admin, firestore };\n"],"names":[],"mappings":"AAAA;;;CAGC;;;AAED;AACA;;;;;;;AAEA,uEAAuE;AACvE,IAAI,CAAC,2HAAA,CAAA,UAAK,CAAC,IAAI,CAAC,MAAM,EAAE;IACtB,2HAAA,CAAA,UAAK,CAAC,aAAa,CAAC;QAClB,qEAAqE;QACrE,+DAA+D;QAC/D,8BAA8B;QAC9B,YAAY,CAAA,GAAA,gJAAA,CAAA,qBAAkB,AAAD;QAC7B,SAAS;IACX;AACF;AAEA,MAAM,YAAY,2HAAA,CAAA,UAAK,CAAC,SAAS","debugId":null}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/auth/discord/callback/route.ts"],"sourcesContent":["\nimport { NextRequest, NextResponse } from 'next/server';\nimport { admin } from '@/lib/firebase';\n\nexport async function GET(req: NextRequest) {\n  const code = req.nextUrl.searchParams.get('code');\n\n  if (!code) {\n    return NextResponse.json({ error: 'Missing authorization code' }, { status: 400 });\n  }\n\n  try {\n    const { DISCORD_CLIENT_ID, DISCORD_CLIENT_SECRET, DISCORD_REDIRECT_URI, NEXT_PUBLIC_BASE_URL } = process.env;\n\n    if (!DISCORD_CLIENT_ID || !DISCORD_CLIENT_SECRET || !DISCORD_REDIRECT_URI || !NEXT_PUBLIC_BASE_URL) {\n      console.error('A required environment variable for Discord OAuth is missing.');\n      return NextResponse.json({ error: 'Server is missing required configuration.' }, { status: 500 });\n    }\n    \n    // 1. Exchange authorization code for an access token\n    const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: DISCORD_CLIENT_ID,\n        client_secret: DISCORD_CLIENT_SECRET,\n        grant_type: 'authorization_code',\n        code,\n        redirect_uri: DISCORD_REDIRECT_URI,\n      }),\n    });\n\n    if (!tokenResponse.ok) {\n        const errorText = await tokenResponse.text();\n        console.error('Discord token exchange failed:', errorText);\n        throw new Error(`Error fetching Discord access token: ${tokenResponse.status} ${errorText}`);\n    }\n\n    const tokenData = await tokenResponse.json();\n    const { access_token } = tokenData;\n\n    // 2. Use the access token to fetch the user's Discord profile\n    const userResponse = await fetch('https://discord.com/api/users/@me', {\n      headers: {\n        Authorization: `Bearer ${access_token}`,\n      },\n    });\n\n    if (!userResponse.ok) {\n        const errorText = await userResponse.text();\n        console.error('Failed to fetch Discord user profile:', errorText);\n        throw new Error(`Failed to fetch user profile from Discord: ${userResponse.status} ${errorText}`);\n    }\n\n    const userData = await userResponse.json();\n\n    // 3. Mint a custom Firebase token using the Discord user ID as the UID\n    const customToken = await admin.auth().createCustomToken(userData.id);\n\n    // 4. Redirect to a frontend page with the custom token\n    const redirectUrl = new URL('/auth/verify', NEXT_PUBLIC_BASE_URL);\n    redirectUrl.searchParams.set('token', customToken);\n\n    return NextResponse.redirect(redirectUrl.toString());\n\n  } catch (error: any) {\n    console.error('Discord callback error:', error.message);\n    return NextResponse.json({ error: error.message || 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;AACA;AACA;AAAA;;;;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,OAAO,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAE1C,IAAI,CAAC,MAAM;QACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,IAAI;QACF,MAAM,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,oBAAoB,EAAE,oBAAoB,EAAE,GAAG,QAAQ,GAAG;QAE5G,IAAI,CAAC,qBAAqB,CAAC,yBAAyB,CAAC,wBAAwB,CAAC,sBAAsB;YAClG,QAAQ,KAAK,CAAC;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4C,GAAG;gBAAE,QAAQ;YAAI;QACjG;QAEA,qDAAqD;QACrD,MAAM,gBAAgB,MAAM,MAAM,wCAAwC;YACxE,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,IAAI,gBAAgB;gBACxB,WAAW;gBACX,eAAe;gBACf,YAAY;gBACZ;gBACA,cAAc;YAChB;QACF;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACnB,MAAM,YAAY,MAAM,cAAc,IAAI;YAC1C,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,IAAI,MAAM,CAAC,qCAAqC,EAAE,cAAc,MAAM,CAAC,CAAC,EAAE,WAAW;QAC/F;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAC1C,MAAM,EAAE,YAAY,EAAE,GAAG;QAEzB,8DAA8D;QAC9D,MAAM,eAAe,MAAM,MAAM,qCAAqC;YACpE,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,cAAc;YACzC;QACF;QAEA,IAAI,CAAC,aAAa,EAAE,EAAE;YAClB,MAAM,YAAY,MAAM,aAAa,IAAI;YACzC,QAAQ,KAAK,CAAC,yCAAyC;YACvD,MAAM,IAAI,MAAM,CAAC,2CAA2C,EAAE,aAAa,MAAM,CAAC,CAAC,EAAE,WAAW;QACpG;QAEA,MAAM,WAAW,MAAM,aAAa,IAAI;QAExC,uEAAuE;QACvE,MAAM,cAAc,MAAM,+JAAA,CAAA,QAAK,CAAC,IAAI,GAAG,iBAAiB,CAAC,SAAS,EAAE;QAEpE,uDAAuD;QACvD,MAAM,cAAc,IAAI,IAAI,gBAAgB;QAC5C,YAAY,YAAY,CAAC,GAAG,CAAC,SAAS;QAEtC,OAAO,gIAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,YAAY,QAAQ;IAEnD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B,MAAM,OAAO;QACtD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF","debugId":null}}]
}