{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/api/auth/discord/callback/route.ts"],"sourcesContent":["\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(req: NextRequest) {\n  const code = req.nextUrl.searchParams.get('code');\n\n  if (!code) {\n    return NextResponse.json({ error: 'Missing authorization code' }, { status: 400 });\n  }\n\n  try {\n    // 1. Exchange authorization code for an access token\n    const tokenResponse = await fetch('https://discord.com/api/oauth2/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        client_id: process.env.DISCORD_CLIENT_ID!,\n        client_secret: process.env.DISCORD_CLIENT_SECRET!,\n        grant_type: 'authorization_code',\n        code,\n        redirect_uri: `${process.env.NEXT_PUBLIC_BASE_URL}/api/auth/discord/callback`,\n      }),\n    });\n\n    if (!tokenResponse.ok) {\n        const errorText = await tokenResponse.text();\n        console.error('Discord token exchange failed:', errorText);\n        throw new Error(`Error fetching Discord access token: ${tokenResponse.status} ${errorText}`);\n    }\n\n    const tokenData = await tokenResponse.json();\n    const { access_token } = tokenData;\n\n    // 2. Use the access token to fetch the user's Discord profile\n    const userResponse = await fetch('https://discord.com/api/users/@me', {\n      headers: {\n        Authorization: `Bearer ${access_token}`,\n      },\n    });\n\n    if (!userResponse.ok) {\n        const errorText = await userResponse.text();\n        console.error('Failed to fetch Discord user profile:', errorText);\n        throw new Error(`Failed to fetch user profile from Discord: ${userResponse.status} ${errorText}`);\n    }\n\n    const userData = await userResponse.json();\n\n    // 3. Log the user profile to verify success (as per instructions)\n    console.log('Successfully fetched Discord user profile:', userData);\n\n    // In a future step, we will mint a Firebase custom token here.\n    // For now, return a success message.\n    return NextResponse.json({\n        status: 'success',\n        message: 'Successfully fetched user profile from Discord. Check server logs.',\n        userProfile: userData\n    });\n\n  } catch (error: any) {\n    console.error('Discord callback error:', error.message);\n    return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;AACA;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,OAAO,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAE1C,IAAI,CAAC,MAAM;QACT,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,IAAI;QACF,qDAAqD;QACrD,MAAM,gBAAgB,MAAM,MAAM,wCAAwC;YACxE,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,IAAI,gBAAgB;gBACxB,WAAW,QAAQ,GAAG,CAAC,iBAAiB;gBACxC,eAAe,QAAQ,GAAG,CAAC,qBAAqB;gBAChD,YAAY;gBACZ;gBACA,cAAc,6DAAoC,0BAA0B,CAAC;YAC/E;QACF;QAEA,IAAI,CAAC,cAAc,EAAE,EAAE;YACnB,MAAM,YAAY,MAAM,cAAc,IAAI;YAC1C,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM,IAAI,MAAM,CAAC,qCAAqC,EAAE,cAAc,MAAM,CAAC,CAAC,EAAE,WAAW;QAC/F;QAEA,MAAM,YAAY,MAAM,cAAc,IAAI;QAC1C,MAAM,EAAE,YAAY,EAAE,GAAG;QAEzB,8DAA8D;QAC9D,MAAM,eAAe,MAAM,MAAM,qCAAqC;YACpE,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,cAAc;YACzC;QACF;QAEA,IAAI,CAAC,aAAa,EAAE,EAAE;YAClB,MAAM,YAAY,MAAM,aAAa,IAAI;YACzC,QAAQ,KAAK,CAAC,yCAAyC;YACvD,MAAM,IAAI,MAAM,CAAC,2CAA2C,EAAE,aAAa,MAAM,CAAC,CAAC,EAAE,WAAW;QACpG;QAEA,MAAM,WAAW,MAAM,aAAa,IAAI;QAExC,kEAAkE;QAClE,QAAQ,GAAG,CAAC,8CAA8C;QAE1D,+DAA+D;QAC/D,qCAAqC;QACrC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACrB,QAAQ;YACR,SAAS;YACT,aAAa;QACjB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B,MAAM,OAAO;QACtD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF","debugId":null}}]
}